jQuery&&!function(e){"use strict";function t(e){var t=e.style.overflow;t&&"visible"!==t||(e.style.overflow="hidden");var s=e.clientWidth<e.scrollWidth;return e.style.overflow=t,s}function s(e){var t=e.find(".hasInput.hover").position().top+e.find(".hasInput.hover").outerHeight();t>e.innerHeight()&&e.scrollTop(e.scrollTop()+t-e.innerHeight()),e.find(".hasInput.hover").position().top<0&&e.scrollTop(e.scrollTop()+e.find(".hasInput.hover").position().top)}function i(t){var s=this.data("ultraselect").options;if(s.optGroupSelectable){var i=!0;e(t).children(":not(.optGroupLabel)").find("input:checkbox").each(function(){e(this).is(":checked")||(i=!1)}),e(t).find("input.optGroup").prop("checked",i).parent().toggleClass("checked",i)}}function a(){var s=this.children(".select"),i=this.children(".options"),a=s.find("span.selection"),n=this.data("ultraselect").options,l=0,o=!0,c="";i.find("input:checkbox").not(".selectAll, .optGroup").each(function(){e(this).is(":checked")?(l+=1,c=c+e(this).parent().text().trim()+", "):o=!1}),c=c.replace(/\s*,\s*$/,""),0===l?s.find("span.selection").html(n.noneSelected):"*"===n.oneOrMoreSelected||n.autoListSelected?(a.html(c),s.attr("title",c),n.autoListSelected&&t(a[0])&&a.html(n.oneOrMoreSelected.replace("%",l))):a.html(n.oneOrMoreSelected.replace("%",l)),n.selectAll&&i.find("input.selectAll").prop("checked",o).parent().toggleClass("checked",o)}function n(t,s){h+=1;var i=t+"_"+h,a=e("<div />",{class:"option"}),n=e("<input />",{type:"checkbox",name:t+"[]",id:i,tabindex:-1}),l=e("<label />",{for:i}),o=e("<span><span></span></span>");return n.val(s.value),s.selected&&n.prop("checked","checked"),a.append(n,l.append(o,s.text)).addClass(s.classes||"").data(s.data)}function l(t,s,i){var a,o,c,r,p=e("<div />",{class:"options"});for(o=0;o<s.length;o+=1)s[o].optgroup?(c=e("<div />"),c.attr("class",s[o].classes||null).addClass("optGroup").data(s[o].data),r=e("<label />"),i.optGroupSelectable&&(h+=1,a=t+"_"+h,c.append(e("<input />",{type:"checkbox",class:"optGroup",id:a,tabindex:-1})),r.attr("for",a).append("<span><span></span></span>")),c.append(r.append(s[o].optgroup)).wrapInner('<div class="optGroupLabel"></div>').append(l(t,s[o].options,i)),p.append(c)):p.append(n(t,s[o]));return p.children()}function o(t){h+=1;var n="selectAll_"+h,o=e(this),c=o.children(".select"),r=o.children(".options"),p=this.data("ultraselect"),d=p.options,u=p.callback;r.html(""),d.selectAll&&r.append(e("<div />",{class:"selectAll"}).append(e("<input />",{type:"checkbox",class:"selectAll",id:n,tabindex:-1}),e("<label />",{for:n}).append("<span><span></span></span>",d.selectAllText))),r.append(l(this.attr("id"),t,d)),o.ultraselect("setListHeight",d.listHeight),d.selectAll&&r.find("input.selectAll").click(function(){r.find("input:checkbox").prop("checked",e(this).is(":checked")).parent().toggleClass("checked",e(this).is(":checked"))}),d.optGroupSelectable&&(r.addClass("optGroupHasCheckboxes"),r.find("input.optGroup").click(function(){e(this).parent().parent().find("input:not(.optGroup, .selectAll):checkbox").prop("checked",e(this).is(":checked")).parent().toggleClass("checked",e(this).is(":checked"))})),r.find("input:checkbox").click(function(){e(this).parent().toggleClass("checked",e(this).is(":checked")),a.call(o),c.focus(),e(this).parent().parent().hasClass("optGroup")&&i.call(o,e(this).parent().parent()),u&&u(e(this))}),r.each(function(){e(this).find("input:checked").parent().addClass("checked")}),a.call(o),d.optGroupSelectable&&r.find("div.optGroup").each(function(){i.call(o,e(this))}),r.find("input:checkbox").parent().addClass("hasInput"),r.find(".hasInput").hover(function(){e(this).parent().find().removeClass("hover"),e(this).addClass("hover")},function(){e(this).removeClass("hover")}),c.keydown(function(t){if(r=e(this).next(".options"),"hidden"!==o.parent().css("overflow")){if(9===t.keyCode)return e(this).addClass("focus").trigger("click"),!0;if(27!==t.keyCode&&37!==t.keyCode&&39!==t.keyCode||e(this).addClass("focus").trigger("click"),40===t.keyCode||38===t.keyCode){var i=r.find(".hasInput"),n=i.index(i.filter(".hover")),l=-1;return n<0?r.find(".hasInput:first").addClass("hover"):40===t.keyCode&&n<i.length-1?l=n+1:38===t.keyCode&&n>0&&(l=n-1),l>=0&&(e(i.get(n)).removeClass("hover"),e(i.get(l)).addClass("hover"),s(r)),!1}if(13===t.keyCode||32===t.keyCode){var c=r.find("div.hover input:checkbox");return c.prop("checked",!c.is(":checked")).parent().toggleClass("checked",c.is(":checked")),c.hasClass("selectAll")&&r.find("input:checkbox").prop("checked",c.is(":checked")).parent().addClass("checked").toggleClass("checked",c.is(":checked")),a.call(o),u&&u(e(this)),!1}if(t.keyCode>=33&&t.keyCode<=126){var h=r.find(".hasInput:startsWith("+String.fromCharCode(t.keyCode)+")"),p=h.index(h.filter(".hasInput.hover")),d=h.filter(function(e){return e>p});h=d.length>=1?d:h,h=h.filter(".hasInput:first"),1===h.length&&(r.find(".hasInput.hover").removeClass("hover"),h.addClass("hover"),s(r))}}else{if(38===t.keyCode||40===t.keyCode||13===t.keyCode||32===t.keyCode)return e(this).removeClass("focus").trigger("click"),r.find(".hasInput:first").addClass("hover"),!1;if(9===t.keyCode)return!0}if(13===t.keyCode)return!1})}function c(t,s,i){this.element=t,this.options=e.extend(!0,{},r,s),this.callback=i,this.init()}String.prototype.trim||!function(){var e=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;String.prototype.trim=function(){return this.replace(e,"")}}();var r={selectAll:!0,selectAllText:"Select All",noneSelected:"Select options",oneOrMoreSelected:"% selected",autoListSelected:!1,optGroupSelectable:!1,listHeight:200,maxWidth:!1},h=0;e.extend(c.prototype,{version:"2.0.0-dev",defaults:r,init:function(){var t=this.options,s=e(this.element);t.maxWidth="none"!==s.css("maxWidth")?s.css("maxWidth"):t.maxWidth;var i=e("<div />",{class:"ultraselect"}),a=e("<div />",{class:"select",tabIndex:0}),n=e("<div />",{class:"options",tabIndex:-1});a.append(e("<span />",{class:"selection"}),e("<span />",{class:"arrow"}).append(e("<b />"))),i.append(a,n),s.after(i),t.maxWidth&&a.css("maxWidth",t.maxWidth),i.addClass(s.attr("class")),i.data(s.data()),this.element=i[0],i.data("ultraselect",this);var l=[];s.children().each(function(){if("optgroup"===this.tagName.toLowerCase()){var t=[];l.push({optgroup:e(this).attr("label"),options:t,classes:e(this).attr("class"),data:e(this).data()||{}}),e(this).children("option").each(function(){""!==e(this).val()&&t.push({text:e(this).html(),value:e(this).val(),selected:e(this).prop("selected"),classes:e(this).attr("class"),data:e(this).data()||{}})})}else"option"===this.tagName.toLowerCase()&&""!==e(this).val()&&l.push({text:e(this).html(),value:e(this).val(),selected:e(this).prop("selected"),classes:e(this).attr("class"),data:e(this).data()||{}})}),s.remove(),i.attr("id",s.attr("id")),o.call(i,l),i.wrap('<div class="ultraselectWrapper"></div>'),i.parent().height(a.outerHeight()),a.hover(function(){e(this).addClass("hover")},function(){e(this).removeClass("hover")}).click(function(){return e(this).hasClass("active")?i.ultraselect("hideOptions"):i.ultraselect("showOptions"),!1}).focus(function(){e(this).addClass("focus")}).blur(function(){e(this).removeClass("focus")}),e(document).click(function(t){e(t.target).parents().addBack().is(".ultraselect > .options")||i.ultraselect("hideOptions")})},getValue:function(){var t=[];return e("input:not(.selectAll, .optGroup)",this.element).each(function(){e(this).is(":checked")&&t.push(e(this).val())}),t},setValue:function(t){var s=t?t:[];return"string"==typeof s&&(s=[t]),e("input:not(.selectAll, .optGroup)",this.element).each(function(){var t=s.indexOf(e(this).val())!==-1;e(this).prop("checked",t).parent().toggleClass("checked",t)}),a.call(e(this.element)),this},updateOptions:function(e){o.call(this,e)},hideOptions:function(){this.children(".select").removeClass("active").removeClass("hover"),this.parent().css("overflow","hidden")},showOptions:function(){var t=this.children(".select"),s=this.children(".options");e(".ultraselect").ultraselect("hideOptions"),this.parent().css("overflow","visible"),s.find(".option, .optGroup").removeClass("hover"),t.addClass("active").focus(),s.scrollTop(0)},selectedString:function(){var t="";return this.find("input:checkbox:checked").not(".optGroup, .selectAll").each(function(){t+=e(this).attr("value")+","}),t.replace(/\s*,\s*$/,"")},setListHeight:function(e){var t=this.children(".options");t.height()>e?(t.css("height",e+"px"),navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&t.addClass("_firefox")):t.css("height","")}}),e.expr[":"].startsWith=function(t,s,i){var a=i[3];return!!a&&new RegExp("^[/s]*"+a,"i").test(e(t).text())};var p=e.fn.val;e.fn.val=function(t){var s;return 0===arguments.length?(s=this.data("ultraselect"),s?s.getValue():p.call(this)):this.each(function(){s=e(this).data("ultraselect"),s?(console.log(s),s.setValue(t)):p.call(e(this),t)})},e.fn.ultraselect=function(t,s){var i=Array.prototype.slice.call(arguments,1);return this.each(function(){e(this).data("ultraselect")?"string"==typeof t&&"function"==typeof c.prototype[t]?e(this).data("ultraselect")[t].apply(e(this),i):console.log("ultraselect: invalid arguments"):new c(this,t,s)})}}(jQuery);